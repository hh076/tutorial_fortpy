// ====================================================================
//
//      Hiroaki HONDA, Yu-ichi INADOMI, and Jun MAKI
//
//      All rights reserved since Aug. 21th 2008.
//      RHF Part of OpenFMO project: http://www.openfmo.org
//      Correspondence: dahon@soc.ait.kyushu-u.ac.jp
// ====================================================================

#include <stdio.h>
#include "PSI_stan.h"
#include "PSI_def_int.h"
#include "PSI_proto_int2.h"

// ====================================================================
// ====================================================================
// ====================================================================

static PSI_LI NCOMPTBL[ ] = {
    1, 3, 6, 10, 15, 28, 0, 0 } ;

static PSI_LI IDXDFCT[ ] = {
    0, 1, 4, 10, 20, 35, 56, 84 } ;

static PSI_LD DFCTTBL[ ] = {
    1.0000000000000000e+00,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    1.7320508075688772e+00, 1.7320508075688772e+00, 1.7320508075688772e+00,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    2.2360679774997898e+00, 2.2360679774997898e+00, 2.2360679774997898e+00,
    2.2360679774997898e+00, 2.2360679774997898e+00, 2.2360679774997898e+00,
    3.8729833462074170e+00,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    2.6457513110645907e+00, 2.6457513110645907e+00, 2.6457513110645907e+00,
    3.3166247903553998e+00, 3.3166247903553998e+00, 3.3166247903553998e+00,
    2.6457513110645907e+00, 2.6457513110645907e+00, 2.6457513110645907e+00,
    5.9160797830996161e+00, 5.9160797830996161e+00, 5.9160797830996161e+00,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    3.0000000000000000e+00, 3.0000000000000000e+00, 3.0000000000000000e+00,
    4.5825756949558398e+00, 4.5825756949558398e+00, 4.5825756949558398e+00,
    4.5825756949558398e+00, 4.5825756949558398e+00, 4.5825756949558398e+00,
    3.0000000000000000e+00, 3.0000000000000000e+00, 3.0000000000000000e+00,
    7.9372539331937721e+00, 7.9372539331937721e+00, 7.9372539331937721e+00,
    1.0246950765959598e+01, 1.0246950765959598e+01, 1.0246950765959598e+01,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    3.3166247903553998e+00, 3.3166247903553998e+00, 3.3166247903553998e+00,
    5.7445626465380286e+00, 5.7445626465380286e+00, 5.7445626465380286e+00,
    6.7823299831252681e+00, 6.7823299831252681e+00, 6.7823299831252681e+00,
    5.7445626465380286e+00, 5.7445626465380286e+00, 5.7445626465380286e+00,
    3.3166247903553998e+00, 3.3166247903553998e+00, 3.3166247903553998e+00,
    9.9498743710661994e+00, 9.9498743710661994e+00, 9.9498743710661994e+00,
    1.5198684153570664e+01, 1.5198684153570664e+01, 1.5198684153570664e+01,
    1.5198684153570664e+01, 1.5198684153570664e+01, 1.5198684153570664e+01,
    1.9621416870348583e+01,
    ///
    1.0000000000000000e+00, 1.0000000000000000e+00, 1.0000000000000000e+00,
    3.6055512754639891e+00, 3.6055512754639891e+00, 3.6055512754639891e+00,
    6.8556546004010439e+00, 6.8556546004010439e+00, 6.8556546004010439e+00,
    9.2195444572928871e+00, 9.2195444572928871e+00, 9.2195444572928871e+00,
    9.2195444572928871e+00, 9.2195444572928871e+00, 9.2195444572928871e+00,
    6.8556546004010439e+00, 6.8556546004010439e+00, 6.8556546004010439e+00,
    3.6055512754639891e+00, 3.6055512754639891e+00, 3.6055512754639891e+00,
    1.1958260743101398e+01, 1.1958260743101398e+01, 1.1958260743101398e+01,
    2.0712315177207980e+01, 2.0712315177207980e+01, 2.0712315177207980e+01,
    2.4494897427831781e+01, 2.4494897427831781e+01, 2.4494897427831781e+01,
    2.0712315177207980e+01, 2.0712315177207980e+01, 2.0712315177207980e+01,
    3.1638584039112750e+01, 3.1638584039112750e+01, 3.1638584039112750e+01 } ;

static int
save_and_mul_fact2 ( PSI_LI inttype, PSI_LI la, PSI_LI lb, PSI_LI lc, PSI_LI ld,
                     PSI_LI *addr_fact, PSI_LD *dint_from, PSI_LD *dint_to )
{
    PSI_LI ia, ib, ic, id, addr_a, addr_ab, addr_abc, addr_abcd, addr ;
    PSI_LI ncomp_a, ncomp_b, ncomp_c, ncomp_d ;
    PSI_LD coef_a, coef_ab, coef_abc, coef_abcd ;
    PSI_LD *DFCT_A, *DFCT_B, *DFCT_C, *DFCT_D ;

    ncomp_a = NCOMPTBL [ la ] ;
    ncomp_b = NCOMPTBL [ lb ] ;
    ncomp_c = NCOMPTBL [ lc ] ;
    ncomp_d = NCOMPTBL [ ld ] ;

    ////if ( la > 1 || lb > 1 || lc > 1 || ld > 1 ) {
    DFCT_A = DFCTTBL + IDXDFCT [ la ] ;
    DFCT_B = DFCTTBL + IDXDFCT [ lb ] ;
    DFCT_C = DFCTTBL + IDXDFCT [ lc ] ;
    DFCT_D = DFCTTBL + IDXDFCT [ ld ] ;

    addr = 0 ;
    for ( ia = 0 ; ia < ncomp_a ; ia++ ) {
      coef_a = DFCT_A [ ia ] ;
      addr_a = ia * ncomp_a ;
      ///
      for ( ib = 0 ; ib < ncomp_b ; ib++ ) {
        coef_ab = coef_a * DFCT_B [ ib ] ;
        addr_ab = ib * ncomp_b + addr_a ;
        ///
        for ( ic = 0 ; ic < ncomp_c ; ic++ ) {
          coef_abc = coef_ab * DFCT_C [ ic ] ;
          addr_abc = ic * ncomp_c + addr_ab ;
          ///
          for ( id = 0 ; id < ncomp_d ; id++ ) {
            coef_abcd = coef_abc * DFCT_D [ id ] ;
            addr_abcd = id * ncomp_d + addr_abc ;
            dint_to [ addr ] = dint_from [ addr ] * coef_abcd ;
#ifdef _DEBUG_INT2SAVE_
      fprintf ( stdout, "from, to: %d: %24p <- %24p\n",
                        addr, &(dint_to[addr]), &(dint_from [addr]) ) ;
#endif /// _DEBUG_INT2SAVE_
            addr++ ;
    } } } }
      ///}

    return 0 ;
}

//////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////
PSI_LI eri0_save ( PSI_LI inttype, PSI_LI la, PSI_LI lb, PSI_LI lc, PSI_LI ld,
                   PSI_LI *addr_fact, PSI_LD *dint_from, PSI_LD *dint_to )
{
#ifdef _DEBUG_INT2SAVE_
    PSI_LI i, ncomp_a, ncomp_b, ncomp_c, ncomp_d, nsize_int ;
    ncomp_a = NCOMPTBL [ la ] ;
    ncomp_b = NCOMPTBL [ lb ] ;
    ncomp_c = NCOMPTBL [ lc ] ;
    ncomp_d = NCOMPTBL [ ld ] ;
    nsize_int = ncomp_a * ncomp_b * ncomp_c * ncomp_d ;
    for ( i = 0 ; i < nsize_int ; i++ ) {
        fprintf ( stdout, "from: %6d%24p%26.16e\n", i, &(dint_from[i]),dint_from [ i ] ) ;
    }
#endif /// _DEBUG_INT2SAVE_

    save_and_mul_fact2 ( inttype, la, lb, lc, ld,
                         addr_fact, dint_from, dint_to ) ;
#ifdef _DEBUG_INT2SAVE_
    for ( i = 0 ; i < nsize_int ; i++ ) {
        fprintf ( stdout, "to  : %6d%24p%26.16e\n", i, &(dint_to[i]),dint_to [ i ] ) ;
    }
#endif /// _DEBUG_INT2SAVE_
    return 0 ;
}

